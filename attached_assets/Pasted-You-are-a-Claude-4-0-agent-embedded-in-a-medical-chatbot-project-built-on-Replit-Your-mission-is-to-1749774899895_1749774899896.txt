You are a Claude 4.0 agent embedded in a medical chatbot project built on Replit. Your mission is to fix the webhook payload once and for all â€” so that all consultation fields sent to /api/webhook/consultation are populated with real values from the user's interaction, not null.

ğŸ” Context:
The chatbot currently sends a POST request to /api/webhook/consultation, but the following fields are always null or empty arrays, despite being collected during the conversation:

symptom_description

issue_specifics

previous_treatment

image_path

image_analysis

calendar_booking

final_question

additional_help

emoji_survey

survey_response

conversation_log

completed_steps

ğŸ¯ Objective:
âœ… Ensure that the chatbotâ€™s internal state accurately maps user responses to each of the above fields
âœ… Bind those values to the payload sent via fetch("/api/webhook/consultation") in use-chat.ts
âœ… Validate that null values are replaced with actual strings, arrays, or safe fallbacks ("", [])

âœ… Must Happen In:
File: client/src/hooks/use-chat.ts

Function: The section that builds and sends the final POST payload via fetch("/api/webhook/consultation")

Confirm that you are accessing the correct variables or state (e.g. symptomDescription, selectedSubIssue, imageUrl, aiAnalysis, etc.)

ğŸ› ï¸ What You Must Fix:
Identify the full internal chatbot state (likely stored in useState, chatStepToField, or similar)

For each field below, map it to the correct variable:

symptom_description â† from user input during symptom step

issue_specifics â† from selected subcategory

previous_treatment â† from history step

has_image â† "true"/"false" based on upload toggle

image_path â† image upload preview URL

image_analysis â† result from OpenAI after upload

calendar_booking â† booking slot (if used)

final_question, additional_help â† from final steps

emoji_survey, survey_response â† from feedback step

conversation_log â† entire chat history array

completed_steps â† array of completed chat step keys

Replace all null values with actual data or safe defaults:

ts
Copy
Edit
symptom_description: symptomDescription || "",
image_analysis: aiAnalysis || "",
completed_steps: completedSteps || [],
âœ… Add This For Debugging:
Just before the fetch() call, log the final payload:

ts
Copy
Edit
console.log("âœ… Final webhook payload:", payload);
âš ï¸ Do NOT:
Modify portal code

Remove required fields

Submit if any value is still null that should not be

ğŸ§© Tech Stack:
React + TypeScript

Vite + TailwindCSS

Express backend

Replit-hosted with webhook to /api/webhook/consultation